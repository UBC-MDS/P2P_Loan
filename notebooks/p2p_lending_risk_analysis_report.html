<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mavis Wong, Yasmin Hassan and Abeba N. Turi">

<title>P2P Online Lending Default Prediction- A Usecase on LendingClub Default Risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="p2p_lending_risk_analysis_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/quarto.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/popper.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="p2p_lending_risk_analysis_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="p2p_lending_risk_analysis_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="p2p_lending_risk_analysis_report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="p2p_lending_risk_analysis_report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">1. Summary<br></a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">2. Introduction <br></a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">3. Methods <br></a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">3.1 Data <br></a></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">4. Results and Discussion <br></a></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">4.2 Feature Engineering</a></li>
  </ul></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">Reference</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">P2P Online Lending Default Prediction- A Usecase on LendingClub Default Risk</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mavis Wong, Yasmin Hassan and Abeba N. Turi </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">1. Summary<br></h2>
<p>This work intends to leaverage machine learning models to predict borrower behaviour and hence probability of default. More specifically, the work focuses aszxon predicting loan defaults using historical data from the Lending Club platform. By applying advanced preprocessing techniques, exploratory data analysis (EDA), and a Logistic Regression model, we uncover patterns and trends in borrower risk profiles. The final model demonstrated strong performance on unseen test data, achieving an accuracy of 84.0%. Out of 1,916 test cases, the model correctly predicted 1,608 cases, with 308 incorrect predictions. These errors included both false positives (predicting a loan default when it didn’t occur) and false negatives (failing to predict an actual default). While false negatives pose a greater risk in financial decision-making, this model provides actionable insights to improve risk management and reduce potential financial losses for the platform. Despite its promising predictive capabilities, further research is needed to enhance the model’s accuracy and better understand the characteristics of misclassified loans. Such improvements could play a crucial role in minimizing financial risks and maximizing the model’s effectiveness in peer-to-peer lending platforms.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">2. Introduction <br></h2>
<p>Crowd-based business models are one of the last decade’s developments with the proliferation of platform economies and web technology applications (see Sutherland and Jarrahi, 2018). One of such developments following the 2007 financial crisis are the P2P online lending platforms. The backbone of the digital economic system built on this is that it relies on trust a currency. Like all other crowd-based business models, P2P online lending heavily relied on trustworthiness of borrowers. To help with this, online platforms like LendingClub used a number of features to define eligibility and rate of access to loan for potential borrowers.Traditional credit risk analysis often relies on rule-based systems or credit scores, which might not fully capture the complexities of borrower behavior. By applying Logistic Regression, we aim to develop a model that is both interpretable and effective in identifying high-risk loans. This analysis intends to provide a data-driven approach to improve credit decision-making in a broader context of platform based transactions through machine learning models. Extensive research has been conducted on borrower risk behaviour analysis and trust within P2P online lending system, highlighting the critical role trust and predictability holds in ensuring platform sustainability and mitigating default risks (Cai, et al, 2016 and Lenz, 2016). Building on this, this work focuses on developing a comprehensive risk analysis framework through machine hlearning models that will help predict borrower behaviour.</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">3. Methods <br></h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">3.1 Data <br></h3>
<section id="data-source" class="level4">
<h4 class="anchored" data-anchor-id="data-source">Data Source</h4>
<p>This analysis is based on the historic loan data from LendingClub (LendingClub. (n.d.) and Matmcreative. (n.d.).). It contains various borrower and loan features, such as interest rates, annual income, debt-to-income ratio (DTI), and credit history. The target variable, not.fully.paid, indicates whether the borrower defaulted on the loan (1) or successfully repaid it (0).</p>
</section>
<section id="feature-description" class="level4">
<h4 class="anchored" data-anchor-id="feature-description">Feature Description</h4>
<p>The key features taken into account for this analysis are:</p>
<p><code>purpose</code>: The purpose of the loan</p>
<p><code>int.rate</code>: Interest rate of the loan the applicant received</p>
<p><code>installment</code>: Monthly payment for the loan the applicant received.</p>
<p><code>log.annual.inc</code>: annual_income (growth rate)</p>
<p><code>dti</code>: Debt-to-income ratio</p>
<p><code>revol.bal</code>: Total credit revolving balance</p>
<p><code>revol.util</code>: Revolving line utilization rate</p>
<p><code>inq.last.6mths</code>: The number of inquiries in past 6 months</p>
<p><code>delinq.2yrs</code>: Delinquencies on lines of credit in the last 2 years.</p>
<p><code>pub.rec</code>: The number of derogatory public records</p>
<p><code>fico</code>: FICO credit score</p>
<p><code>days.with.cr.line</code>: Days with Credit Line</p>
<p><code>not.fully.paid</code>: Binary response on weather the loan is paid or not.</p>
<section id="data-splitting-to-training-and-testing-data" class="level5">
<h5 class="anchored" data-anchor-id="data-splitting-to-training-and-testing-data">Data Splitting to Training and Testing Data</h5>
<p>Train-Test Split:</p>
<p>The dataset was split into training (80%) and test (20%) sets, resulting in 1916 observations in the test set. Features: The model was trained on both numeric features (e.g., int.rate, installment) and categorical features (e.g., purpose, loan_categories).</p>
<p>Preprocessing:</p>
<p>Numeric features were scaled using StandardScaler, while categorical features were one-hot encoded. Missing values were imputed using the median (numeric) or most frequent value (categorical).</p>
</section>
</section>
<section id="analysis" class="level4">
<h4 class="anchored" data-anchor-id="analysis">3.2 Analysis <br></h4>
<ul>
<li><p>Train-Test Split: The dataset was split into training (80%) and test (20%) sets, resulting in 1916 observations in the test set. <br></p></li>
<li><p>Features: The model was trained on both numeric features (e.g., int.rate, installment) and categorical features (e.g., purpose, loan_categories).</p></li>
<li><p>Preprocessing: Numeric features were scaled using StandardScaler, while categorical features were one-hot encoded. Missing values were imputed using the median (numeric) or most frequent value (categorical).</p></li>
<li><p>Model: Logistic Regression was selected as the final model for its simplicity, slightly higher accuracy, and interpretability. All columns except <code>risk_category</code> were used in model fitting. <code>risk_category</code> was drop due to it being redundant to “loan_categories” (both derived from “fico” score). A grid search with 10-fold cross-validation on the hyperparameter <code>C</code> of the logistic regression model is used for optimization. Python language was used to conduct this analysis.</p></li>
</ul>
</section>
</section>
<section id="results-and-discussion" class="level3">
<h3 class="anchored" data-anchor-id="results-and-discussion">4. Results and Discussion <br></h3>
<p>In order for us to draw context about the data, let us have a look at the first few rows of the data; check the info about all columns, data types, and number of NaN values; and summary statistis.</p>
<div id="6896a6f9" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">credit.policy</th>
<th data-quarto-table-cell-role="th">purpose</th>
<th data-quarto-table-cell-role="th">int.rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">log.annual.inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">fico</th>
<th data-quarto-table-cell-role="th">days.with.cr.line</th>
<th data-quarto-table-cell-role="th">revol.bal</th>
<th data-quarto-table-cell-role="th">revol.util</th>
<th data-quarto-table-cell-role="th">inq.last.6mths</th>
<th data-quarto-table-cell-role="th">delinq.2yrs</th>
<th data-quarto-table-cell-role="th">pub.rec</th>
<th data-quarto-table-cell-role="th">not.fully.paid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1189</td>
<td>829.10</td>
<td>11.350407</td>
<td>19.48</td>
<td>737</td>
<td>5639.958333</td>
<td>28854</td>
<td>52.1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>credit_card</td>
<td>0.1071</td>
<td>228.22</td>
<td>11.082143</td>
<td>14.29</td>
<td>707</td>
<td>2760.000000</td>
<td>33623</td>
<td>76.7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1357</td>
<td>366.86</td>
<td>10.373491</td>
<td>11.63</td>
<td>682</td>
<td>4710.000000</td>
<td>3511</td>
<td>25.6</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1008</td>
<td>162.34</td>
<td>11.350407</td>
<td>8.10</td>
<td>712</td>
<td>2699.958333</td>
<td>33667</td>
<td>73.2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>credit_card</td>
<td>0.1426</td>
<td>102.92</td>
<td>11.299732</td>
<td>14.97</td>
<td>667</td>
<td>4066.000000</td>
<td>4740</td>
<td>39.5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="38bc1d51" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 9578 entries, 0 to 9577
Data columns (total 14 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   credit.policy      9578 non-null   int64  
 1   purpose            9578 non-null   object 
 2   int.rate           9578 non-null   float64
 3   installment        9578 non-null   float64
 4   log.annual.inc     9578 non-null   float64
 5   dti                9578 non-null   float64
 6   fico               9578 non-null   int64  
 7   days.with.cr.line  9578 non-null   float64
 8   revol.bal          9578 non-null   int64  
 9   revol.util         9578 non-null   float64
 10  inq.last.6mths     9578 non-null   int64  
 11  delinq.2yrs        9578 non-null   int64  
 12  pub.rec            9578 non-null   int64  
 13  not.fully.paid     9578 non-null   int64  
dtypes: float64(6), int64(7), object(1)
memory usage: 1.0+ MB</code></pre>
</div>
</div>
<div id="b4eaed94" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">credit.policy</th>
<th data-quarto-table-cell-role="th">purpose</th>
<th data-quarto-table-cell-role="th">int.rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">log.annual.inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">fico</th>
<th data-quarto-table-cell-role="th">days.with.cr.line</th>
<th data-quarto-table-cell-role="th">revol.bal</th>
<th data-quarto-table-cell-role="th">revol.util</th>
<th data-quarto-table-cell-role="th">inq.last.6mths</th>
<th data-quarto-table-cell-role="th">delinq.2yrs</th>
<th data-quarto-table-cell-role="th">pub.rec</th>
<th data-quarto-table-cell-role="th">not.fully.paid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1189</td>
<td>829.10</td>
<td>11.350407</td>
<td>19.48</td>
<td>737</td>
<td>5639.958333</td>
<td>28854</td>
<td>52.1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>credit_card</td>
<td>0.1071</td>
<td>228.22</td>
<td>11.082143</td>
<td>14.29</td>
<td>707</td>
<td>2760.000000</td>
<td>33623</td>
<td>76.7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1357</td>
<td>366.86</td>
<td>10.373491</td>
<td>11.63</td>
<td>682</td>
<td>4710.000000</td>
<td>3511</td>
<td>25.6</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>debt_consolidation</td>
<td>0.1008</td>
<td>162.34</td>
<td>11.350407</td>
<td>8.10</td>
<td>712</td>
<td>2699.958333</td>
<td>33667</td>
<td>73.2</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>credit_card</td>
<td>0.1426</td>
<td>102.92</td>
<td>11.299732</td>
<td>14.97</td>
<td>667</td>
<td>4066.000000</td>
<td>4740</td>
<td>39.5</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9573</td>
<td>0</td>
<td>all_other</td>
<td>0.1461</td>
<td>344.76</td>
<td>12.180755</td>
<td>10.39</td>
<td>672</td>
<td>10474.000000</td>
<td>215372</td>
<td>82.1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9574</td>
<td>0</td>
<td>all_other</td>
<td>0.1253</td>
<td>257.70</td>
<td>11.141862</td>
<td>0.21</td>
<td>722</td>
<td>4380.000000</td>
<td>184</td>
<td>1.1</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9575</td>
<td>0</td>
<td>debt_consolidation</td>
<td>0.1071</td>
<td>97.81</td>
<td>10.596635</td>
<td>13.09</td>
<td>687</td>
<td>3450.041667</td>
<td>10036</td>
<td>82.9</td>
<td>8</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9576</td>
<td>0</td>
<td>home_improvement</td>
<td>0.1600</td>
<td>351.58</td>
<td>10.819778</td>
<td>19.18</td>
<td>692</td>
<td>1800.000000</td>
<td>0</td>
<td>3.2</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9577</td>
<td>0</td>
<td>debt_consolidation</td>
<td>0.1392</td>
<td>853.43</td>
<td>11.264464</td>
<td>16.28</td>
<td>732</td>
<td>4740.000000</td>
<td>37879</td>
<td>57.0</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>9578 rows × 14 columns</p>
</div>
</div>
</div>
<section id="data-splitting" class="level4">
<h4 class="anchored" data-anchor-id="data-splitting">4.1 Data splitting</h4>
<p>Split the data into <code>train_df</code> (80%) and <code>test_df</code> (20%) with <code>random_state = 522</code>.</p>
<div id="8e135486" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display" data-execution_count="6">
<style type="text/css">
#T_6e2e7_row0_col0, #T_6e2e7_row1_col1, #T_6e2e7_row2_col2, #T_6e2e7_row3_col3, #T_6e2e7_row4_col4, #T_6e2e7_row5_col5, #T_6e2e7_row6_col6, #T_6e2e7_row7_col7, #T_6e2e7_row8_col8, #T_6e2e7_row9_col9, #T_6e2e7_row10_col10, #T_6e2e7_row11_col11, #T_6e2e7_row12_col12 {
  background-color: #b40426;
  color: #f1f1f1;
  background-color: black;
}
#T_6e2e7_row0_col1, #T_6e2e7_row1_col0 {
  background-color: #b1cbfc;
  color: #000000;
}
#T_6e2e7_row0_col2, #T_6e2e7_row1_col3, #T_6e2e7_row2_col0, #T_6e2e7_row2_col12, #T_6e2e7_row3_col1, #T_6e2e7_row3_col8, #T_6e2e7_row7_col12, #T_6e2e7_row8_col3, #T_6e2e7_row12_col2, #T_6e2e7_row12_col7 {
  background-color: #e4d9d2;
  color: #000000;
}
#T_6e2e7_row0_col3, #T_6e2e7_row3_col0, #T_6e2e7_row4_col12, #T_6e2e7_row12_col4 {
  background-color: #e1dad6;
  color: #000000;
}
#T_6e2e7_row0_col4, #T_6e2e7_row4_col0 {
  background-color: #d2dbe8;
  color: #000000;
}
#T_6e2e7_row0_col5, #T_6e2e7_row3_col6, #T_6e2e7_row5_col0, #T_6e2e7_row6_col3 {
  background-color: #f7b79b;
  color: #000000;
}
#T_6e2e7_row0_col6, #T_6e2e7_row1_col7, #T_6e2e7_row6_col0, #T_6e2e7_row6_col10, #T_6e2e7_row7_col1, #T_6e2e7_row10_col6 {
  background-color: #e8d6cc;
  color: #000000;
}
#T_6e2e7_row0_col7, #T_6e2e7_row7_col0 {
  background-color: #c1d4f4;
  color: #000000;
}
#T_6e2e7_row0_col8, #T_6e2e7_row8_col0 {
  background-color: #cfdaea;
  color: #000000;
}
#T_6e2e7_row0_col9, #T_6e2e7_row5_col8, #T_6e2e7_row8_col5, #T_6e2e7_row9_col0 {
  background-color: #86a9fc;
  color: #f1f1f1;
}
#T_6e2e7_row0_col10, #T_6e2e7_row10_col0 {
  background-color: #d3dbe7;
  color: #000000;
}
#T_6e2e7_row0_col11, #T_6e2e7_row3_col4, #T_6e2e7_row4_col3, #T_6e2e7_row11_col0 {
  background-color: #d5dbe5;
  color: #000000;
}
#T_6e2e7_row0_col12, #T_6e2e7_row5_col11, #T_6e2e7_row5_col12, #T_6e2e7_row11_col5, #T_6e2e7_row12_col0, #T_6e2e7_row12_col5 {
  background-color: #c7d7f0;
  color: #000000;
}
#T_6e2e7_row1_col2, #T_6e2e7_row2_col1 {
  background-color: #f6bfa6;
  color: #000000;
}
#T_6e2e7_row1_col4, #T_6e2e7_row4_col1 {
  background-color: #f2c9b4;
  color: #000000;
}
#T_6e2e7_row1_col5, #T_6e2e7_row5_col1 {
  background-color: #6788ee;
  color: #f1f1f1;
}
#T_6e2e7_row1_col6, #T_6e2e7_row6_col1 {
  background-color: #ccd9ed;
  color: #000000;
}
#T_6e2e7_row1_col8, #T_6e2e7_row8_col1 {
  background-color: #f6a283;
  color: #000000;
}
#T_6e2e7_row1_col9, #T_6e2e7_row7_col8, #T_6e2e7_row8_col7, #T_6e2e7_row9_col1 {
  background-color: #f2cbb7;
  color: #000000;
}
#T_6e2e7_row1_col10, #T_6e2e7_row10_col1 {
  background-color: #efcfbf;
  color: #000000;
}
#T_6e2e7_row1_col11, #T_6e2e7_row11_col1 {
  background-color: #e9d5cb;
  color: #000000;
}
#T_6e2e7_row1_col12, #T_6e2e7_row12_col1 {
  background-color: #efcebd;
  color: #000000;
}
#T_6e2e7_row2_col3, #T_6e2e7_row3_col2 {
  background-color: #f6a586;
  color: #000000;
}
#T_6e2e7_row2_col4, #T_6e2e7_row4_col2, #T_6e2e7_row4_col6, #T_6e2e7_row6_col4, #T_6e2e7_row11_col12, #T_6e2e7_row12_col11 {
  background-color: #e3d9d3;
  color: #000000;
}
#T_6e2e7_row2_col5, #T_6e2e7_row2_col8, #T_6e2e7_row5_col2, #T_6e2e7_row8_col2, #T_6e2e7_row8_col12, #T_6e2e7_row12_col8 {
  background-color: #e7d7ce;
  color: #000000;
}
#T_6e2e7_row2_col6, #T_6e2e7_row4_col7, #T_6e2e7_row6_col2, #T_6e2e7_row7_col4 {
  background-color: #f1cdba;
  color: #000000;
}
#T_6e2e7_row2_col7, #T_6e2e7_row6_col7, #T_6e2e7_row7_col2, #T_6e2e7_row7_col6 {
  background-color: #f3c7b1;
  color: #000000;
}
#T_6e2e7_row2_col9, #T_6e2e7_row2_col10, #T_6e2e7_row4_col11, #T_6e2e7_row9_col2, #T_6e2e7_row10_col2, #T_6e2e7_row11_col4 {
  background-color: #dcdddd;
  color: #000000;
}
#T_6e2e7_row2_col11, #T_6e2e7_row3_col12, #T_6e2e7_row6_col12, #T_6e2e7_row7_col10, #T_6e2e7_row7_col11, #T_6e2e7_row10_col7, #T_6e2e7_row11_col2, #T_6e2e7_row11_col7, #T_6e2e7_row12_col3, #T_6e2e7_row12_col6 {
  background-color: #d8dce2;
  color: #000000;
}
#T_6e2e7_row3_col5, #T_6e2e7_row5_col3 {
  background-color: #ead4c8;
  color: #000000;
}
#T_6e2e7_row3_col7, #T_6e2e7_row7_col3 {
  background-color: #f7b194;
  color: #000000;
}
#T_6e2e7_row3_col9, #T_6e2e7_row3_col11, #T_6e2e7_row4_col9, #T_6e2e7_row9_col3, #T_6e2e7_row9_col4, #T_6e2e7_row11_col3 {
  background-color: #dfdbd9;
  color: #000000;
}
#T_6e2e7_row3_col10, #T_6e2e7_row7_col9, #T_6e2e7_row9_col7, #T_6e2e7_row10_col3 {
  background-color: #e0dbd8;
  color: #000000;
}
#T_6e2e7_row4_col5, #T_6e2e7_row5_col4 {
  background-color: #bad0f8;
  color: #000000;
}
#T_6e2e7_row4_col8, #T_6e2e7_row8_col4 {
  background-color: #f7b89c;
  color: #000000;
}
#T_6e2e7_row4_col10, #T_6e2e7_row6_col8, #T_6e2e7_row8_col6, #T_6e2e7_row8_col9, #T_6e2e7_row9_col8, #T_6e2e7_row10_col4 {
  background-color: #dadce0;
  color: #000000;
}
#T_6e2e7_row5_col6, #T_6e2e7_row6_col5 {
  background-color: #f5c4ac;
  color: #000000;
}
#T_6e2e7_row5_col7, #T_6e2e7_row7_col5 {
  background-color: #dbdcde;
  color: #000000;
}
#T_6e2e7_row5_col9, #T_6e2e7_row9_col5 {
  background-color: #c3d5f4;
  color: #000000;
}
#T_6e2e7_row5_col10, #T_6e2e7_row10_col5 {
  background-color: #bed2f6;
  color: #000000;
}
#T_6e2e7_row6_col9, #T_6e2e7_row8_col10, #T_6e2e7_row9_col6, #T_6e2e7_row10_col8 {
  background-color: #d7dce3;
  color: #000000;
}
#T_6e2e7_row6_col11, #T_6e2e7_row9_col11, #T_6e2e7_row11_col6, #T_6e2e7_row11_col9 {
  background-color: #e6d7cf;
  color: #000000;
}
#T_6e2e7_row8_col11, #T_6e2e7_row11_col8 {
  background-color: #e5d8d1;
  color: #000000;
}
#T_6e2e7_row9_col10, #T_6e2e7_row10_col9, #T_6e2e7_row10_col12, #T_6e2e7_row12_col10 {
  background-color: #dedcdb;
  color: #000000;
}
#T_6e2e7_row9_col12, #T_6e2e7_row12_col9 {
  background-color: #edd1c2;
  color: #000000;
}
#T_6e2e7_row10_col11, #T_6e2e7_row11_col10 {
  background-color: #dddcdc;
  color: #000000;
}
</style>

<table id="T_6e2e7" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_6e2e7_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">credit.policy</th>
<th id="T_6e2e7_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">int.rate</th>
<th id="T_6e2e7_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">installment</th>
<th id="T_6e2e7_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">log.annual.inc</th>
<th id="T_6e2e7_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">dti</th>
<th id="T_6e2e7_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">fico</th>
<th id="T_6e2e7_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">days.with.cr.line</th>
<th id="T_6e2e7_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">revol.bal</th>
<th id="T_6e2e7_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">revol.util</th>
<th id="T_6e2e7_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">inq.last.6mths</th>
<th id="T_6e2e7_level0_col10" class="col_heading level0 col10" data-quarto-table-cell-role="th">delinq.2yrs</th>
<th id="T_6e2e7_level0_col11" class="col_heading level0 col11" data-quarto-table-cell-role="th">pub.rec</th>
<th id="T_6e2e7_level0_col12" class="col_heading level0 col12" data-quarto-table-cell-role="th">not.fully.paid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_6e2e7_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">credit.policy</td>
<td id="T_6e2e7_row0_col0" class="data row0 col0">1.00</td>
<td id="T_6e2e7_row0_col1" class="data row0 col1">-0.29</td>
<td id="T_6e2e7_row0_col2" class="data row0 col2">0.06</td>
<td id="T_6e2e7_row0_col3" class="data row0 col3">0.03</td>
<td id="T_6e2e7_row0_col4" class="data row0 col4">-0.08</td>
<td id="T_6e2e7_row0_col5" class="data row0 col5">0.34</td>
<td id="T_6e2e7_row0_col6" class="data row0 col6">0.09</td>
<td id="T_6e2e7_row0_col7" class="data row0 col7">-0.19</td>
<td id="T_6e2e7_row0_col8" class="data row0 col8">-0.10</td>
<td id="T_6e2e7_row0_col9" class="data row0 col9">-0.53</td>
<td id="T_6e2e7_row0_col10" class="data row0 col10">-0.07</td>
<td id="T_6e2e7_row0_col11" class="data row0 col11">-0.06</td>
<td id="T_6e2e7_row0_col12" class="data row0 col12">-0.15</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">int.rate</td>
<td id="T_6e2e7_row1_col0" class="data row1 col0">-0.29</td>
<td id="T_6e2e7_row1_col1" class="data row1 col1">1.00</td>
<td id="T_6e2e7_row1_col2" class="data row1 col2">0.28</td>
<td id="T_6e2e7_row1_col3" class="data row1 col3">0.06</td>
<td id="T_6e2e7_row1_col4" class="data row1 col4">0.22</td>
<td id="T_6e2e7_row1_col5" class="data row1 col5">-0.71</td>
<td id="T_6e2e7_row1_col6" class="data row1 col6">-0.12</td>
<td id="T_6e2e7_row1_col7" class="data row1 col7">0.09</td>
<td id="T_6e2e7_row1_col8" class="data row1 col8">0.46</td>
<td id="T_6e2e7_row1_col9" class="data row1 col9">0.20</td>
<td id="T_6e2e7_row1_col10" class="data row1 col10">0.16</td>
<td id="T_6e2e7_row1_col11" class="data row1 col11">0.10</td>
<td id="T_6e2e7_row1_col12" class="data row1 col12">0.17</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">installment</td>
<td id="T_6e2e7_row2_col0" class="data row2 col0">0.06</td>
<td id="T_6e2e7_row2_col1" class="data row2 col1">0.28</td>
<td id="T_6e2e7_row2_col2" class="data row2 col2">1.00</td>
<td id="T_6e2e7_row2_col3" class="data row2 col3">0.44</td>
<td id="T_6e2e7_row2_col4" class="data row2 col4">0.05</td>
<td id="T_6e2e7_row2_col5" class="data row2 col5">0.08</td>
<td id="T_6e2e7_row2_col6" class="data row2 col6">0.18</td>
<td id="T_6e2e7_row2_col7" class="data row2 col7">0.23</td>
<td id="T_6e2e7_row2_col8" class="data row2 col8">0.08</td>
<td id="T_6e2e7_row2_col9" class="data row2 col9">-0.00</td>
<td id="T_6e2e7_row2_col10" class="data row2 col10">-0.00</td>
<td id="T_6e2e7_row2_col11" class="data row2 col11">-0.03</td>
<td id="T_6e2e7_row2_col12" class="data row2 col12">0.06</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">log.annual.inc</td>
<td id="T_6e2e7_row3_col0" class="data row3 col0">0.03</td>
<td id="T_6e2e7_row3_col1" class="data row3 col1">0.06</td>
<td id="T_6e2e7_row3_col2" class="data row3 col2">0.44</td>
<td id="T_6e2e7_row3_col3" class="data row3 col3">1.00</td>
<td id="T_6e2e7_row3_col4" class="data row3 col4">-0.06</td>
<td id="T_6e2e7_row3_col5" class="data row3 col5">0.11</td>
<td id="T_6e2e7_row3_col6" class="data row3 col6">0.34</td>
<td id="T_6e2e7_row3_col7" class="data row3 col7">0.37</td>
<td id="T_6e2e7_row3_col8" class="data row3 col8">0.06</td>
<td id="T_6e2e7_row3_col9" class="data row3 col9">0.02</td>
<td id="T_6e2e7_row3_col10" class="data row3 col10">0.02</td>
<td id="T_6e2e7_row3_col11" class="data row3 col11">0.02</td>
<td id="T_6e2e7_row3_col12" class="data row3 col12">-0.03</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">dti</td>
<td id="T_6e2e7_row4_col0" class="data row4 col0">-0.08</td>
<td id="T_6e2e7_row4_col1" class="data row4 col1">0.22</td>
<td id="T_6e2e7_row4_col2" class="data row4 col2">0.05</td>
<td id="T_6e2e7_row4_col3" class="data row4 col3">-0.06</td>
<td id="T_6e2e7_row4_col4" class="data row4 col4">1.00</td>
<td id="T_6e2e7_row4_col5" class="data row4 col5">-0.24</td>
<td id="T_6e2e7_row4_col6" class="data row4 col6">0.05</td>
<td id="T_6e2e7_row4_col7" class="data row4 col7">0.18</td>
<td id="T_6e2e7_row4_col8" class="data row4 col8">0.34</td>
<td id="T_6e2e7_row4_col9" class="data row4 col9">0.02</td>
<td id="T_6e2e7_row4_col10" class="data row4 col10">-0.02</td>
<td id="T_6e2e7_row4_col11" class="data row4 col11">-0.00</td>
<td id="T_6e2e7_row4_col12" class="data row4 col12">0.03</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">fico</td>
<td id="T_6e2e7_row5_col0" class="data row5 col0">0.34</td>
<td id="T_6e2e7_row5_col1" class="data row5 col1">-0.71</td>
<td id="T_6e2e7_row5_col2" class="data row5 col2">0.08</td>
<td id="T_6e2e7_row5_col3" class="data row5 col3">0.11</td>
<td id="T_6e2e7_row5_col4" class="data row5 col4">-0.24</td>
<td id="T_6e2e7_row5_col5" class="data row5 col5">1.00</td>
<td id="T_6e2e7_row5_col6" class="data row5 col6">0.25</td>
<td id="T_6e2e7_row5_col7" class="data row5 col7">-0.01</td>
<td id="T_6e2e7_row5_col8" class="data row5 col8">-0.54</td>
<td id="T_6e2e7_row5_col9" class="data row5 col9">-0.18</td>
<td id="T_6e2e7_row5_col10" class="data row5 col10">-0.22</td>
<td id="T_6e2e7_row5_col11" class="data row5 col11">-0.15</td>
<td id="T_6e2e7_row5_col12" class="data row5 col12">-0.15</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">days.with.cr.line</td>
<td id="T_6e2e7_row6_col0" class="data row6 col0">0.09</td>
<td id="T_6e2e7_row6_col1" class="data row6 col1">-0.12</td>
<td id="T_6e2e7_row6_col2" class="data row6 col2">0.18</td>
<td id="T_6e2e7_row6_col3" class="data row6 col3">0.34</td>
<td id="T_6e2e7_row6_col4" class="data row6 col4">0.05</td>
<td id="T_6e2e7_row6_col5" class="data row6 col5">0.25</td>
<td id="T_6e2e7_row6_col6" class="data row6 col6">1.00</td>
<td id="T_6e2e7_row6_col7" class="data row6 col7">0.23</td>
<td id="T_6e2e7_row6_col8" class="data row6 col8">-0.02</td>
<td id="T_6e2e7_row6_col9" class="data row6 col9">-0.04</td>
<td id="T_6e2e7_row6_col10" class="data row6 col10">0.09</td>
<td id="T_6e2e7_row6_col11" class="data row6 col11">0.08</td>
<td id="T_6e2e7_row6_col12" class="data row6 col12">-0.03</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">revol.bal</td>
<td id="T_6e2e7_row7_col0" class="data row7 col0">-0.19</td>
<td id="T_6e2e7_row7_col1" class="data row7 col1">0.09</td>
<td id="T_6e2e7_row7_col2" class="data row7 col2">0.23</td>
<td id="T_6e2e7_row7_col3" class="data row7 col3">0.37</td>
<td id="T_6e2e7_row7_col4" class="data row7 col4">0.18</td>
<td id="T_6e2e7_row7_col5" class="data row7 col5">-0.01</td>
<td id="T_6e2e7_row7_col6" class="data row7 col6">0.23</td>
<td id="T_6e2e7_row7_col7" class="data row7 col7">1.00</td>
<td id="T_6e2e7_row7_col8" class="data row7 col8">0.20</td>
<td id="T_6e2e7_row7_col9" class="data row7 col9">0.03</td>
<td id="T_6e2e7_row7_col10" class="data row7 col10">-0.03</td>
<td id="T_6e2e7_row7_col11" class="data row7 col11">-0.03</td>
<td id="T_6e2e7_row7_col12" class="data row7 col12">0.06</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">revol.util</td>
<td id="T_6e2e7_row8_col0" class="data row8 col0">-0.10</td>
<td id="T_6e2e7_row8_col1" class="data row8 col1">0.46</td>
<td id="T_6e2e7_row8_col2" class="data row8 col2">0.08</td>
<td id="T_6e2e7_row8_col3" class="data row8 col3">0.06</td>
<td id="T_6e2e7_row8_col4" class="data row8 col4">0.34</td>
<td id="T_6e2e7_row8_col5" class="data row8 col5">-0.54</td>
<td id="T_6e2e7_row8_col6" class="data row8 col6">-0.02</td>
<td id="T_6e2e7_row8_col7" class="data row8 col7">0.20</td>
<td id="T_6e2e7_row8_col8" class="data row8 col8">1.00</td>
<td id="T_6e2e7_row8_col9" class="data row8 col9">-0.02</td>
<td id="T_6e2e7_row8_col10" class="data row8 col10">-0.04</td>
<td id="T_6e2e7_row8_col11" class="data row8 col11">0.07</td>
<td id="T_6e2e7_row8_col12" class="data row8 col12">0.08</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">inq.last.6mths</td>
<td id="T_6e2e7_row9_col0" class="data row9 col0">-0.53</td>
<td id="T_6e2e7_row9_col1" class="data row9 col1">0.20</td>
<td id="T_6e2e7_row9_col2" class="data row9 col2">-0.00</td>
<td id="T_6e2e7_row9_col3" class="data row9 col3">0.02</td>
<td id="T_6e2e7_row9_col4" class="data row9 col4">0.02</td>
<td id="T_6e2e7_row9_col5" class="data row9 col5">-0.18</td>
<td id="T_6e2e7_row9_col6" class="data row9 col6">-0.04</td>
<td id="T_6e2e7_row9_col7" class="data row9 col7">0.03</td>
<td id="T_6e2e7_row9_col8" class="data row9 col8">-0.02</td>
<td id="T_6e2e7_row9_col9" class="data row9 col9">1.00</td>
<td id="T_6e2e7_row9_col10" class="data row9 col10">0.01</td>
<td id="T_6e2e7_row9_col11" class="data row9 col11">0.08</td>
<td id="T_6e2e7_row9_col12" class="data row9 col12">0.15</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row10" class="row_heading level0 row10" data-quarto-table-cell-role="th">delinq.2yrs</td>
<td id="T_6e2e7_row10_col0" class="data row10 col0">-0.07</td>
<td id="T_6e2e7_row10_col1" class="data row10 col1">0.16</td>
<td id="T_6e2e7_row10_col2" class="data row10 col2">-0.00</td>
<td id="T_6e2e7_row10_col3" class="data row10 col3">0.02</td>
<td id="T_6e2e7_row10_col4" class="data row10 col4">-0.02</td>
<td id="T_6e2e7_row10_col5" class="data row10 col5">-0.22</td>
<td id="T_6e2e7_row10_col6" class="data row10 col6">0.09</td>
<td id="T_6e2e7_row10_col7" class="data row10 col7">-0.03</td>
<td id="T_6e2e7_row10_col8" class="data row10 col8">-0.04</td>
<td id="T_6e2e7_row10_col9" class="data row10 col9">0.01</td>
<td id="T_6e2e7_row10_col10" class="data row10 col10">1.00</td>
<td id="T_6e2e7_row10_col11" class="data row10 col11">0.01</td>
<td id="T_6e2e7_row10_col12" class="data row10 col12">0.01</td>
</tr>
<tr class="even">
<td id="T_6e2e7_level0_row11" class="row_heading level0 row11" data-quarto-table-cell-role="th">pub.rec</td>
<td id="T_6e2e7_row11_col0" class="data row11 col0">-0.06</td>
<td id="T_6e2e7_row11_col1" class="data row11 col1">0.10</td>
<td id="T_6e2e7_row11_col2" class="data row11 col2">-0.03</td>
<td id="T_6e2e7_row11_col3" class="data row11 col3">0.02</td>
<td id="T_6e2e7_row11_col4" class="data row11 col4">-0.00</td>
<td id="T_6e2e7_row11_col5" class="data row11 col5">-0.15</td>
<td id="T_6e2e7_row11_col6" class="data row11 col6">0.08</td>
<td id="T_6e2e7_row11_col7" class="data row11 col7">-0.03</td>
<td id="T_6e2e7_row11_col8" class="data row11 col8">0.07</td>
<td id="T_6e2e7_row11_col9" class="data row11 col9">0.08</td>
<td id="T_6e2e7_row11_col10" class="data row11 col10">0.01</td>
<td id="T_6e2e7_row11_col11" class="data row11 col11">1.00</td>
<td id="T_6e2e7_row11_col12" class="data row11 col12">0.05</td>
</tr>
<tr class="odd">
<td id="T_6e2e7_level0_row12" class="row_heading level0 row12" data-quarto-table-cell-role="th">not.fully.paid</td>
<td id="T_6e2e7_row12_col0" class="data row12 col0">-0.15</td>
<td id="T_6e2e7_row12_col1" class="data row12 col1">0.17</td>
<td id="T_6e2e7_row12_col2" class="data row12 col2">0.06</td>
<td id="T_6e2e7_row12_col3" class="data row12 col3">-0.03</td>
<td id="T_6e2e7_row12_col4" class="data row12 col4">0.03</td>
<td id="T_6e2e7_row12_col5" class="data row12 col5">-0.15</td>
<td id="T_6e2e7_row12_col6" class="data row12 col6">-0.03</td>
<td id="T_6e2e7_row12_col7" class="data row12 col7">0.06</td>
<td id="T_6e2e7_row12_col8" class="data row12 col8">0.08</td>
<td id="T_6e2e7_row12_col9" class="data row12 col9">0.15</td>
<td id="T_6e2e7_row12_col10" class="data row12 col10">0.01</td>
<td id="T_6e2e7_row12_col11" class="data row12 col11">0.05</td>
<td id="T_6e2e7_row12_col12" class="data row12 col12">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="61483432" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code>not.fully.paid
0    0.839859
1    0.160141
Name: proportion, dtype: float64
not.fully.paid
0    0.840292
1    0.159708
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<div id="598cbcae" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>(7662, 14)</code></pre>
</div>
</div>
<div id="15c97996" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">credit.policy</th>
<th data-quarto-table-cell-role="th">purpose</th>
<th data-quarto-table-cell-role="th">int.rate</th>
<th data-quarto-table-cell-role="th">installment</th>
<th data-quarto-table-cell-role="th">log.annual.inc</th>
<th data-quarto-table-cell-role="th">dti</th>
<th data-quarto-table-cell-role="th">fico</th>
<th data-quarto-table-cell-role="th">days.with.cr.line</th>
<th data-quarto-table-cell-role="th">revol.bal</th>
<th data-quarto-table-cell-role="th">revol.util</th>
<th data-quarto-table-cell-role="th">inq.last.6mths</th>
<th data-quarto-table-cell-role="th">delinq.2yrs</th>
<th data-quarto-table-cell-role="th">pub.rec</th>
<th data-quarto-table-cell-role="th">not.fully.paid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7662.000000</td>
<td>7662</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7.662000e+03</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
<td>7662.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>NaN</td>
<td>7</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>NaN</td>
<td>debt_consolidation</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>NaN</td>
<td>3172</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.807883</td>
<td>NaN</td>
<td>0.122498</td>
<td>318.706990</td>
<td>10.932388</td>
<td>12.626631</td>
<td>710.975463</td>
<td>4574.926113</td>
<td>1.717180e+04</td>
<td>46.870501</td>
<td>1.566562</td>
<td>0.159358</td>
<td>0.062386</td>
<td>0.160141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>0.393990</td>
<td>NaN</td>
<td>0.026774</td>
<td>207.488994</td>
<td>0.614014</td>
<td>6.867246</td>
<td>37.763921</td>
<td>2508.344473</td>
<td>3.518355e+04</td>
<td>28.941005</td>
<td>2.166408</td>
<td>0.531531</td>
<td>0.263564</td>
<td>0.366761</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>NaN</td>
<td>0.060000</td>
<td>15.670000</td>
<td>7.547502</td>
<td>0.000000</td>
<td>612.000000</td>
<td>180.041667</td>
<td>0.000000e+00</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25%</td>
<td>1.000000</td>
<td>NaN</td>
<td>0.103900</td>
<td>163.570000</td>
<td>10.555813</td>
<td>7.260000</td>
<td>682.000000</td>
<td>2820.000000</td>
<td>3.224250e+03</td>
<td>22.800000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50%</td>
<td>1.000000</td>
<td>NaN</td>
<td>0.122100</td>
<td>267.740000</td>
<td>10.918718</td>
<td>12.730000</td>
<td>707.000000</td>
<td>4140.041667</td>
<td>8.707500e+03</td>
<td>46.300000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.000000</td>
<td>NaN</td>
<td>0.139300</td>
<td>435.540000</td>
<td>11.289832</td>
<td>17.940000</td>
<td>737.000000</td>
<td>5730.041667</td>
<td>1.837150e+04</td>
<td>70.900000</td>
<td>2.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000</td>
<td>NaN</td>
<td>0.216400</td>
<td>926.830000</td>
<td>14.180154</td>
<td>29.960000</td>
<td>827.000000</td>
<td>17639.958330</td>
<td>1.207359e+06</td>
<td>119.000000</td>
<td>33.000000</td>
<td>13.000000</td>
<td>5.000000</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">4.2 Feature Engineering</h3>
<p>Here, from a business perspective, we need to identify high-risk and low-risk loan profiles to improve lending profitability while minimizing default rates. This includes assessing borrower behavior, income stability, and loan utilization to create a predictive model for effective risk categorization (see Coşer et al., 2019 and Khandani et al.,2010).</p>
<p>Key metrix and considerations: - Debt-to-Income Ratio - Credit Utilization Ratio( revol.util)_ how much of their revolving credit borrowers are using relative to their limit with higher values indicating possible financial strain. - Loan Duration vs.&nbsp;Risk: If longer-term loans are associated with higher default rate (days.with.cr.line).</p>
<section id="loan-categories" class="level5">
<h5 class="anchored" data-anchor-id="loan-categories">Loan categories</h5>
<p>Below, to help us create the loan categories, we are using the FICO risk profile categories [see the Borrower risk profiles categories from here](https://www.consumerfinance.gov/data-research/consumer-credit-trends/student-loans/borrower-risk-profiles/#:~:text=We%20focus%20on%20five%20credit%20score%20levels%3A&amp;text=Subprime%20(credit%20scores%20of%20580,scores%20of%20720%20or%20above) - Deep subprime (credit scores below 580) - Subprime (credit scores of 580-619) - Near-prime (credit scores of 620-659) - Prime (credit scores of 660-719) - Super-prime (credit scores of 720 or above)</p>
</section>
<section id="risk-categories" class="level5">
<h5 class="anchored" data-anchor-id="risk-categories">Risk categories</h5>
<p>Let us explore the data further with specific borrower risk profile categories Based on the above 5 loan categories, we framed three main risk categories as high, medium and low risk profile with: fico score of at least 720 (Low Risk), ‘fico’ score between 650 and 720 (‘Medium Risk’) and ‘fico’ score of 650 as ‘High Risk’.</p>
</section>
<section id="descriptive-analysis--eda" class="level4">
<h4 class="anchored" data-anchor-id="descriptive-analysis--eda">4.3 Descriptive Analysis- EDA</h4>
<p>To evaluate the usefulness of predictors for identifying loan defaults, we conducted an exploratory data analysis. Features such as int.rate (interest rate) and dti (debt-to-income ratio) displayed notable differences between borrowers who fully paid their loans and those who defaulted. For example, loans with higher interest rates (int.rate) were associated with a greater likelihood of default, while borrowers with lower debt-to-income ratios (dti) were less likely to default. Categorical features like purpose also provided significant insights; loans categorized under “small business” and “credit card” showed higher default rates compared to others, such as “home improvement.”</p>
<div id="7846ec02" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-1.png" width="600" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-2.png" width="614" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-3.png" width="589" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-4.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-5.png" width="614" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-6.png" width="623" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-7.png" width="589" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-8.png" width="606" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-9.png" width="589" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="p2p_lending_risk_analysis_report_files/figure-html/cell-15-output-10.png" width="589" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d0f3415b" class="cell" data-execution_count="15">
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MaxRowsError</span>                              Traceback (most recent call last)
File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:2004</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>
<span class="ansi-green-fg ansi-bold">   2002</span> context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">top_level</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg">-&gt; 2004</span> vegalite_spec: Any <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_top_schema_base</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">TopLevelMixin</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">   2005</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">validate</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ignore</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ignore</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pre_transform</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   2006</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   2008</span> <span style="font-style:italic;color:rgb(95,135,135)"># TODO: following entries are added after validation. Should they be validated?</span>
<span class="ansi-green-fg ansi-bold">   2009</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_top_level:
<span class="ansi-green-fg ansi-bold">   2010</span>     <span style="font-style:italic;color:rgb(95,135,135)"># since this is top-level we add $schema if it's missing</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:1163</span>, in <span class="ansi-cyan-fg">SchemaBase.to_dict</span><span class="ansi-blue-fg">(self, validate, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1161</span>     msg <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">type</span>(<span style="color:rgb(0,135,0)">self</span>)<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> instance has both a value and properties : cannot serialize to dict</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1162</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(msg)
<span class="ansi-green-fg">-&gt; 1163</span> result <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">opts</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> validate:
<span class="ansi-green-fg ansi-bold">   1165</span>     <span style="font-style:italic;color:rgb(95,135,135)"># NOTE: Don't raise `from err`, see `SchemaValidationError` doc</span>
<span class="ansi-green-fg ansi-bold">   1166</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:553</span>, in <span class="ansi-cyan-fg">_todict</span><span class="ansi-blue-fg">(obj, context, np_opt, pd_opt)</span>
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg">--&gt; 553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">{</span>
<span class="ansi-green-fg ansi-bold">    554</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    555</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">for</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">items</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    556</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">if</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">is</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">not</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">Undefined</span>
<span class="ansi-green-fg ansi-bold">    557</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">}</span>
<span class="ansi-green-fg ansi-bold">    558</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaLike):
<span class="ansi-green-fg ansi-bold">    559</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict()

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:554</span>, in <span class="ansi-cyan-fg">&lt;dictcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg ansi-bold">    553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> {
<span class="ansi-green-fg">--&gt; 554</span>         k: <span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    555</span>         <span style="font-weight:bold;color:rgb(0,135,0)">for</span> k, v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj<span style="color:rgb(98,98,98)">.</span>items()
<span class="ansi-green-fg ansi-bold">    556</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> Undefined
<span class="ansi-green-fg ansi-bold">    557</span>     }
<span class="ansi-green-fg ansi-bold">    558</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaLike):
<span class="ansi-green-fg ansi-bold">    559</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict()

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:549</span>, in <span class="ansi-cyan-fg">_todict</span><span class="ansi-blue-fg">(obj, context, np_opt, pd_opt)</span>
<span class="ansi-green-fg ansi-bold">    547</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> result
<span class="ansi-green-fg ansi-bold">    548</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaBase):
<span class="ansi-green-fg">--&gt; 549</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    550</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, (<span style="color:rgb(0,135,0)">list</span>, <span style="color:rgb(0,135,0)">tuple</span>)):
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:4033</span>, in <span class="ansi-cyan-fg">Chart.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   4031</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> core<span style="color:rgb(98,98,98)">.</span>InlineData(values<span style="color:rgb(98,98,98)">=</span>[{}])
<span class="ansi-green-fg ansi-bold">   4032</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>(Chart, copy)<span style="color:rgb(98,98,98)">.</span>to_dict(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwds)
<span class="ansi-green-fg">-&gt; 4033</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:1998</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1995</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   1996</span>         <span style="font-style:italic;color:rgb(95,135,135)"># Non-narwhalifiable type supported by Altair, such as dict</span>
<span class="ansi-green-fg ansi-bold">   1997</span>         data <span style="color:rgb(98,98,98)">=</span> original_data
<span class="ansi-green-fg">-&gt; 1998</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_prepare_data</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1999</span>     context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">data</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:283</span>, in <span class="ansi-cyan-fg">_prepare_data</span><span class="ansi-blue-fg">(data, context)</span>
<span class="ansi-green-fg ansi-bold">    281</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">dict</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> _is_data_type(data):
<span class="ansi-green-fg ansi-bold">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> func <span style="color:rgb(98,98,98)">:=</span> data_transformers<span style="color:rgb(98,98,98)">.</span>get():
<span class="ansi-green-fg">--&gt; 283</span>         data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">nw</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_native</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pass_through</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    285</span> <span style="font-style:italic;color:rgb(95,135,135)"># convert string input to a URLData</span>
<span class="ansi-green-fg ansi-bold">    286</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">str</span>):

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/data.py:42</span>, in <span class="ansi-cyan-fg">default_data_transformer</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">     39</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> pipe
<span class="ansi-green-fg ansi-bold">     41</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">---&gt; 42</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> to_values(<span class="ansi-yellow-bg">limit_rows</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">max_rows</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_rows</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:165</span>, in <span class="ansi-cyan-fg">limit_rows</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">    162</span>     values <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> max_rows <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">len</span>(values) <span style="color:rgb(98,98,98)">&gt;</span> max_rows:
<span class="ansi-green-fg">--&gt; 165</span>     <span class="ansi-yellow-bg">raise_max_rows_error</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    167</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> data

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:148</span>, in <span class="ansi-cyan-fg">limit_rows.&lt;locals&gt;.raise_max_rows_error</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">    135</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">raise_max_rows_error</span>():
<span class="ansi-green-fg ansi-bold">    136</span>     msg <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    137</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The number of rows in your dataset is greater </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    138</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">than the maximum allowed (</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>max_rows<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">).</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    146</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">on how to plot large datasets.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    147</span>     )
<span class="ansi-green-fg">--&gt; 148</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MaxRowsError(msg)

<span class="ansi-red-fg">MaxRowsError</span>: The number of rows in your dataset is greater than the maximum allowed (5000).

Try enabling the VegaFusion data transformer which raises this limit by pre-evaluating data
transformations in Python.
    &gt;&gt; import altair as alt
    &gt;&gt; alt.data_transformers.enable("vegafusion")

Or, see https://altair-viz.github.io/user_guide/large_datasets.html for additional information
on how to plot large datasets.</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>alt.RepeatChart(...)</code></pre>
</div>
</div>
<div id="6d0fbbc5" class="cell" data-execution_count="16">
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MaxRowsError</span>                              Traceback (most recent call last)
File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:4033</span>, in <span class="ansi-cyan-fg">Chart.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   4031</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> core<span style="color:rgb(98,98,98)">.</span>InlineData(values<span style="color:rgb(98,98,98)">=</span>[{}])
<span class="ansi-green-fg ansi-bold">   4032</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>(Chart, copy)<span style="color:rgb(98,98,98)">.</span>to_dict(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwds)
<span class="ansi-green-fg">-&gt; 4033</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:1998</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1995</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   1996</span>         <span style="font-style:italic;color:rgb(95,135,135)"># Non-narwhalifiable type supported by Altair, such as dict</span>
<span class="ansi-green-fg ansi-bold">   1997</span>         data <span style="color:rgb(98,98,98)">=</span> original_data
<span class="ansi-green-fg">-&gt; 1998</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_prepare_data</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1999</span>     context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">data</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:283</span>, in <span class="ansi-cyan-fg">_prepare_data</span><span class="ansi-blue-fg">(data, context)</span>
<span class="ansi-green-fg ansi-bold">    281</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">dict</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> _is_data_type(data):
<span class="ansi-green-fg ansi-bold">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> func <span style="color:rgb(98,98,98)">:=</span> data_transformers<span style="color:rgb(98,98,98)">.</span>get():
<span class="ansi-green-fg">--&gt; 283</span>         data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">nw</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_native</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pass_through</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    285</span> <span style="font-style:italic;color:rgb(95,135,135)"># convert string input to a URLData</span>
<span class="ansi-green-fg ansi-bold">    286</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">str</span>):

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/data.py:42</span>, in <span class="ansi-cyan-fg">default_data_transformer</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">     39</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> pipe
<span class="ansi-green-fg ansi-bold">     41</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">---&gt; 42</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> to_values(<span class="ansi-yellow-bg">limit_rows</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">max_rows</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_rows</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:165</span>, in <span class="ansi-cyan-fg">limit_rows</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">    162</span>     values <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> max_rows <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">len</span>(values) <span style="color:rgb(98,98,98)">&gt;</span> max_rows:
<span class="ansi-green-fg">--&gt; 165</span>     <span class="ansi-yellow-bg">raise_max_rows_error</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    167</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> data

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:148</span>, in <span class="ansi-cyan-fg">limit_rows.&lt;locals&gt;.raise_max_rows_error</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">    135</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">raise_max_rows_error</span>():
<span class="ansi-green-fg ansi-bold">    136</span>     msg <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    137</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The number of rows in your dataset is greater </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    138</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">than the maximum allowed (</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>max_rows<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">).</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    146</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">on how to plot large datasets.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    147</span>     )
<span class="ansi-green-fg">--&gt; 148</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MaxRowsError(msg)

<span class="ansi-red-fg">MaxRowsError</span>: The number of rows in your dataset is greater than the maximum allowed (5000).

Try enabling the VegaFusion data transformer which raises this limit by pre-evaluating data
transformations in Python.
    &gt;&gt; import altair as alt
    &gt;&gt; alt.data_transformers.enable("vegafusion")

Or, see https://altair-viz.github.io/user_guide/large_datasets.html for additional information
on how to plot large datasets.</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>alt.Chart(...)</code></pre>
</div>
</div>
<p>We have a high concentration of loans in the medium risk category and significant number low risk borrowers as compared to the high risk borrowers.</p>
<div id="6dbee465" class="cell" data-execution_count="17">
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MaxRowsError</span>                              Traceback (most recent call last)
File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:4033</span>, in <span class="ansi-cyan-fg">Chart.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   4031</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> core<span style="color:rgb(98,98,98)">.</span>InlineData(values<span style="color:rgb(98,98,98)">=</span>[{}])
<span class="ansi-green-fg ansi-bold">   4032</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>(Chart, copy)<span style="color:rgb(98,98,98)">.</span>to_dict(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwds)
<span class="ansi-green-fg">-&gt; 4033</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:1998</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1995</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   1996</span>         <span style="font-style:italic;color:rgb(95,135,135)"># Non-narwhalifiable type supported by Altair, such as dict</span>
<span class="ansi-green-fg ansi-bold">   1997</span>         data <span style="color:rgb(98,98,98)">=</span> original_data
<span class="ansi-green-fg">-&gt; 1998</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_prepare_data</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1999</span>     context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">data</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:283</span>, in <span class="ansi-cyan-fg">_prepare_data</span><span class="ansi-blue-fg">(data, context)</span>
<span class="ansi-green-fg ansi-bold">    281</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">dict</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> _is_data_type(data):
<span class="ansi-green-fg ansi-bold">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> func <span style="color:rgb(98,98,98)">:=</span> data_transformers<span style="color:rgb(98,98,98)">.</span>get():
<span class="ansi-green-fg">--&gt; 283</span>         data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">nw</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_native</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pass_through</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    285</span> <span style="font-style:italic;color:rgb(95,135,135)"># convert string input to a URLData</span>
<span class="ansi-green-fg ansi-bold">    286</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">str</span>):

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/data.py:42</span>, in <span class="ansi-cyan-fg">default_data_transformer</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">     39</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> pipe
<span class="ansi-green-fg ansi-bold">     41</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">---&gt; 42</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> to_values(<span class="ansi-yellow-bg">limit_rows</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">max_rows</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_rows</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:165</span>, in <span class="ansi-cyan-fg">limit_rows</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">    162</span>     values <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> max_rows <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">len</span>(values) <span style="color:rgb(98,98,98)">&gt;</span> max_rows:
<span class="ansi-green-fg">--&gt; 165</span>     <span class="ansi-yellow-bg">raise_max_rows_error</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    167</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> data

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:148</span>, in <span class="ansi-cyan-fg">limit_rows.&lt;locals&gt;.raise_max_rows_error</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">    135</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">raise_max_rows_error</span>():
<span class="ansi-green-fg ansi-bold">    136</span>     msg <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    137</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The number of rows in your dataset is greater </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    138</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">than the maximum allowed (</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>max_rows<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">).</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    146</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">on how to plot large datasets.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    147</span>     )
<span class="ansi-green-fg">--&gt; 148</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MaxRowsError(msg)

<span class="ansi-red-fg">MaxRowsError</span>: The number of rows in your dataset is greater than the maximum allowed (5000).

Try enabling the VegaFusion data transformer which raises this limit by pre-evaluating data
transformations in Python.
    &gt;&gt; import altair as alt
    &gt;&gt; alt.data_transformers.enable("vegafusion")

Or, see https://altair-viz.github.io/user_guide/large_datasets.html for additional information
on how to plot large datasets.</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>alt.Chart(...)</code></pre>
</div>
</div>
<div id="41b20ccc" class="cell" data-execution_count="18">
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MaxRowsError</span>                              Traceback (most recent call last)
File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:2004</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>
<span class="ansi-green-fg ansi-bold">   2002</span> context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">top_level</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>
<span class="ansi-green-fg">-&gt; 2004</span> vegalite_spec: Any <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_top_schema_base</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">TopLevelMixin</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">   2005</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">validate</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ignore</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">ignore</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pre_transform</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   2006</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   2008</span> <span style="font-style:italic;color:rgb(95,135,135)"># TODO: following entries are added after validation. Should they be validated?</span>
<span class="ansi-green-fg ansi-bold">   2009</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> is_top_level:
<span class="ansi-green-fg ansi-bold">   2010</span>     <span style="font-style:italic;color:rgb(95,135,135)"># since this is top-level we add $schema if it's missing</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:1163</span>, in <span class="ansi-cyan-fg">SchemaBase.to_dict</span><span class="ansi-blue-fg">(self, validate, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1161</span>     msg <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">type</span>(<span style="color:rgb(0,135,0)">self</span>)<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> instance has both a value and properties : cannot serialize to dict</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1162</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> <span style="font-weight:bold;color:rgb(215,95,95)">ValueError</span>(msg)
<span class="ansi-green-fg">-&gt; 1163</span> result <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">opts</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> validate:
<span class="ansi-green-fg ansi-bold">   1165</span>     <span style="font-style:italic;color:rgb(95,135,135)"># NOTE: Don't raise `from err`, see `SchemaValidationError` doc</span>
<span class="ansi-green-fg ansi-bold">   1166</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:553</span>, in <span class="ansi-cyan-fg">_todict</span><span class="ansi-blue-fg">(obj, context, np_opt, pd_opt)</span>
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg">--&gt; 553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">{</span>
<span class="ansi-green-fg ansi-bold">    554</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">:</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    555</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">for</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">k</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">items</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    556</span> <span class="ansi-yellow-bg">        </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">if</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">is</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">not</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">Undefined</span>
<span class="ansi-green-fg ansi-bold">    557</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">}</span>
<span class="ansi-green-fg ansi-bold">    558</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaLike):
<span class="ansi-green-fg ansi-bold">    559</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict()

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:554</span>, in <span class="ansi-cyan-fg">&lt;dictcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg ansi-bold">    553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> {
<span class="ansi-green-fg">--&gt; 554</span>         k: <span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    555</span>         <span style="font-weight:bold;color:rgb(0,135,0)">for</span> k, v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj<span style="color:rgb(98,98,98)">.</span>items()
<span class="ansi-green-fg ansi-bold">    556</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> Undefined
<span class="ansi-green-fg ansi-bold">    557</span>     }
<span class="ansi-green-fg ansi-bold">    558</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaLike):
<span class="ansi-green-fg ansi-bold">    559</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict()

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:551</span>, in <span class="ansi-cyan-fg">_todict</span><span class="ansi-blue-fg">(obj, context, np_opt, pd_opt)</span>
<span class="ansi-green-fg ansi-bold">    549</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict(validate<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>, context<span style="color:rgb(98,98,98)">=</span>context)
<span class="ansi-green-fg ansi-bold">    550</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, (<span style="color:rgb(0,135,0)">list</span>, <span style="color:rgb(0,135,0)">tuple</span>)):
<span class="ansi-green-fg">--&gt; 551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">for</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(175,0,255)" class="ansi-yellow-bg">in</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">obj</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg ansi-bold">    553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> {
<span class="ansi-green-fg ansi-bold">    554</span>         k: _todict(v, context, np_opt, pd_opt)
<span class="ansi-green-fg ansi-bold">    555</span>         <span style="font-weight:bold;color:rgb(0,135,0)">for</span> k, v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj<span style="color:rgb(98,98,98)">.</span>items()
<span class="ansi-green-fg ansi-bold">    556</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> Undefined
<span class="ansi-green-fg ansi-bold">    557</span>     }

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:551</span>, in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-fg ansi-bold">    549</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> obj<span style="color:rgb(98,98,98)">.</span>to_dict(validate<span style="color:rgb(98,98,98)">=</span><span style="font-weight:bold;color:rgb(0,135,0)">False</span>, context<span style="color:rgb(98,98,98)">=</span>context)
<span class="ansi-green-fg ansi-bold">    550</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, (<span style="color:rgb(0,135,0)">list</span>, <span style="color:rgb(0,135,0)">tuple</span>)):
<span class="ansi-green-fg">--&gt; 551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [<span class="ansi-yellow-bg">_todict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">v</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">np_opt</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pd_opt</span><span class="ansi-yellow-bg">)</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]
<span class="ansi-green-fg ansi-bold">    552</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, <span style="color:rgb(0,135,0)">dict</span>):
<span class="ansi-green-fg ansi-bold">    553</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> {
<span class="ansi-green-fg ansi-bold">    554</span>         k: _todict(v, context, np_opt, pd_opt)
<span class="ansi-green-fg ansi-bold">    555</span>         <span style="font-weight:bold;color:rgb(0,135,0)">for</span> k, v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj<span style="color:rgb(98,98,98)">.</span>items()
<span class="ansi-green-fg ansi-bold">    556</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> v <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> Undefined
<span class="ansi-green-fg ansi-bold">    557</span>     }

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/schemapi.py:549</span>, in <span class="ansi-cyan-fg">_todict</span><span class="ansi-blue-fg">(obj, context, np_opt, pd_opt)</span>
<span class="ansi-green-fg ansi-bold">    547</span>         <span style="font-weight:bold;color:rgb(0,135,0)">return</span> result
<span class="ansi-green-fg ansi-bold">    548</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, SchemaBase):
<span class="ansi-green-fg">--&gt; 549</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">obj</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    550</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(obj, (<span style="color:rgb(0,135,0)">list</span>, <span style="color:rgb(0,135,0)">tuple</span>)):
<span class="ansi-green-fg ansi-bold">    551</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> [_todict(v, context, np_opt, pd_opt) <span style="font-weight:bold;color:rgb(0,135,0)">for</span> v <span style="font-weight:bold;color:rgb(175,0,255)">in</span> obj]

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:4033</span>, in <span class="ansi-cyan-fg">Chart.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   4031</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> core<span style="color:rgb(98,98,98)">.</span>InlineData(values<span style="color:rgb(98,98,98)">=</span>[{}])
<span class="ansi-green-fg ansi-bold">   4032</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)">super</span>(Chart, copy)<span style="color:rgb(98,98,98)">.</span>to_dict(<span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwds)
<span class="ansi-green-fg">-&gt; 4033</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">super</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_dict</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwds</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:1998</span>, in <span class="ansi-cyan-fg">TopLevelMixin.to_dict</span><span class="ansi-blue-fg">(self, validate, format, ignore, context)</span>
<span class="ansi-green-fg ansi-bold">   1995</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> <span style="font-weight:bold;color:rgb(215,95,95)">TypeError</span>:
<span class="ansi-green-fg ansi-bold">   1996</span>         <span style="font-style:italic;color:rgb(95,135,135)"># Non-narwhalifiable type supported by Altair, such as dict</span>
<span class="ansi-green-fg ansi-bold">   1997</span>         data <span style="color:rgb(98,98,98)">=</span> original_data
<span class="ansi-green-fg">-&gt; 1998</span>     copy<span style="color:rgb(98,98,98)">.</span>data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_prepare_data</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">context</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">   1999</span>     context[<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">data</span><span style="color:rgb(175,0,0)">"</span>] <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">   2001</span> <span style="font-style:italic;color:rgb(95,135,135)"># remaining to_dict calls are not at top level</span>

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/v5/api.py:283</span>, in <span class="ansi-cyan-fg">_prepare_data</span><span class="ansi-blue-fg">(data, context)</span>
<span class="ansi-green-fg ansi-bold">    281</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">dict</span>) <span style="font-weight:bold;color:rgb(175,0,255)">and</span> _is_data_type(data):
<span class="ansi-green-fg ansi-bold">    282</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> func <span style="color:rgb(98,98,98)">:=</span> data_transformers<span style="color:rgb(98,98,98)">.</span>get():
<span class="ansi-green-fg">--&gt; 283</span>         data <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">nw</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_native</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">pass_through</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">True</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    285</span> <span style="font-style:italic;color:rgb(95,135,135)"># convert string input to a URLData</span>
<span class="ansi-green-fg ansi-bold">    286</span> <span style="font-weight:bold;color:rgb(0,135,0)">elif</span> <span style="color:rgb(0,135,0)">isinstance</span>(data, <span style="color:rgb(0,135,0)">str</span>):

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/vegalite/data.py:42</span>, in <span class="ansi-cyan-fg">default_data_transformer</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">     39</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> pipe
<span class="ansi-green-fg ansi-bold">     41</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">---&gt; 42</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> to_values(<span class="ansi-yellow-bg">limit_rows</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">max_rows</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">max_rows</span><span class="ansi-yellow-bg">)</span>)

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:165</span>, in <span class="ansi-cyan-fg">limit_rows</span><span class="ansi-blue-fg">(data, max_rows)</span>
<span class="ansi-green-fg ansi-bold">    162</span>     values <span style="color:rgb(98,98,98)">=</span> data
<span class="ansi-green-fg ansi-bold">    164</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> max_rows <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="color:rgb(0,135,0)">len</span>(values) <span style="color:rgb(98,98,98)">&gt;</span> max_rows:
<span class="ansi-green-fg">--&gt; 165</span>     <span class="ansi-yellow-bg">raise_max_rows_error</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    167</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> data

File <span class="ansi-green-fg">~/miniforge3/envs/loan_risk522/lib/python3.11/site-packages/altair/utils/data.py:148</span>, in <span class="ansi-cyan-fg">limit_rows.&lt;locals&gt;.raise_max_rows_error</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">    135</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">raise_max_rows_error</span>():
<span class="ansi-green-fg ansi-bold">    136</span>     msg <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    137</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">The number of rows in your dataset is greater </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    138</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">than the maximum allowed (</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>max_rows<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">).</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="font-weight:bold;color:rgb(175,95,0)">\n</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    146</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">on how to plot large datasets.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    147</span>     )
<span class="ansi-green-fg">--&gt; 148</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MaxRowsError(msg)

<span class="ansi-red-fg">MaxRowsError</span>: The number of rows in your dataset is greater than the maximum allowed (5000).

Try enabling the VegaFusion data transformer which raises this limit by pre-evaluating data
transformations in Python.
    &gt;&gt; import altair as alt
    &gt;&gt; alt.data_transformers.enable("vegafusion")

Or, see https://altair-viz.github.io/user_guide/large_datasets.html for additional information
on how to plot large datasets.</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>alt.VConcatChart(...)</code></pre>
</div>
</div>
<p>From the boxplot above, we see that the low risk borrowers have lower average debt-to-income-ratio as compared to the borrowers with medium and high risk profile, based on their fico score. Note also the outliers in FICO scores for the loan purpose of debt consolidation type.</p>
</section>
<section id="correlation-analysis" class="level4">
<h4 class="anchored" data-anchor-id="correlation-analysis">4.4 Correlation Analysis</h4>
<p>The EDA for most of the numerical columns produce no strong general trends. We see a higher correlation level between fico and revo.util, and that of fico and interest rate</p>
<div id="7fcda9f4" class="cell" data-execution_count="19">
<div class="cell-output cell-output-display" data-execution_count="19">

<style>
  #altair-viz-d45da4967c2a4502ae1fde7ffdf04d98.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-d45da4967c2a4502ae1fde7ffdf04d98.vega-embed details,
  #altair-viz-d45da4967c2a4502ae1fde7ffdf04d98.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-d45da4967c2a4502ae1fde7ffdf04d98"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d45da4967c2a4502ae1fde7ffdf04d98") {
      outputDiv = document.getElementById("altair-viz-d45da4967c2a4502ae1fde7ffdf04d98");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-8fbdbcad364c2a65dd118cd71632d7fe"}, "mark": {"type": "rect"}, "encoding": {"color": {"field": "Correlation", "scale": {"scheme": "viridis"}, "type": "quantitative"}, "tooltip": [{"field": "Variable 1", "type": "nominal"}, {"field": "Variable 2", "type": "nominal"}, {"field": "Correlation", "type": "quantitative"}], "x": {"axis": {"labelAngle": -45}, "field": "Variable 1", "title": "", "type": "nominal"}, "y": {"field": "Variable 2", "title": "", "type": "nominal"}}, "height": 400, "title": "Correlation Heatmap", "width": 400, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-8fbdbcad364c2a65dd118cd71632d7fe": [{"Variable 1": "int.rate", "Variable 2": "int.rate", "Correlation": 1.0}, {"Variable 1": "installment", "Variable 2": "int.rate", "Correlation": 0.2826844802575887}, {"Variable 1": "log.annual.inc", "Variable 2": "int.rate", "Correlation": 0.056208806444079114}, {"Variable 1": "dti", "Variable 2": "int.rate", "Correlation": 0.21672786790553042}, {"Variable 1": "fico", "Variable 2": "int.rate", "Correlation": -0.7130360105069175}, {"Variable 1": "days.with.cr.line", "Variable 2": "int.rate", "Correlation": -0.1217758897837466}, {"Variable 1": "revol.bal", "Variable 2": "int.rate", "Correlation": 0.09171674909731617}, {"Variable 1": "revol.util", "Variable 2": "int.rate", "Correlation": 0.45877250859611823}, {"Variable 1": "inq.last.6mths", "Variable 2": "int.rate", "Correlation": 0.20303216402183577}, {"Variable 1": "annual.inc", "Variable 2": "int.rate", "Correlation": 0.03980220552293717}, {"Variable 1": "int.rate", "Variable 2": "installment", "Correlation": 0.2826844802575887}, {"Variable 1": "installment", "Variable 2": "installment", "Correlation": 1.0}, {"Variable 1": "log.annual.inc", "Variable 2": "installment", "Correlation": 0.43981931720043743}, {"Variable 1": "dti", "Variable 2": "installment", "Correlation": 0.05270920805548185}, {"Variable 1": "fico", "Variable 2": "installment", "Correlation": 0.08008117426468929}, {"Variable 1": "days.with.cr.line", "Variable 2": "installment", "Correlation": 0.18189761041793417}, {"Variable 1": "revol.bal", "Variable 2": "installment", "Correlation": 0.2298025606808621}, {"Variable 1": "revol.util", "Variable 2": "installment", "Correlation": 0.08295323053751776}, {"Variable 1": "inq.last.6mths", "Variable 2": "installment", "Correlation": -0.0040004293887224845}, {"Variable 1": "annual.inc", "Variable 2": "installment", "Correlation": 0.3109994843055651}, {"Variable 1": "int.rate", "Variable 2": "log.annual.inc", "Correlation": 0.056208806444079114}, {"Variable 1": "installment", "Variable 2": "log.annual.inc", "Correlation": 0.43981931720043743}, {"Variable 1": "log.annual.inc", "Variable 2": "log.annual.inc", "Correlation": 1.0}, {"Variable 1": "dti", "Variable 2": "log.annual.inc", "Correlation": -0.05534838607810262}, {"Variable 1": "fico", "Variable 2": "log.annual.inc", "Correlation": 0.10955820478606884}, {"Variable 1": "days.with.cr.line", "Variable 2": "log.annual.inc", "Correlation": 0.33912910065344076}, {"Variable 1": "revol.bal", "Variable 2": "log.annual.inc", "Correlation": 0.3747024846815357}, {"Variable 1": "revol.util", "Variable 2": "log.annual.inc", "Correlation": 0.05972736554294546}, {"Variable 1": "inq.last.6mths", "Variable 2": "log.annual.inc", "Correlation": 0.02251940151157754}, {"Variable 1": "annual.inc", "Variable 2": "log.annual.inc", "Correlation": 0.7955875382758022}, {"Variable 1": "int.rate", "Variable 2": "dti", "Correlation": 0.21672786790553042}, {"Variable 1": "installment", "Variable 2": "dti", "Correlation": 0.05270920805548185}, {"Variable 1": "log.annual.inc", "Variable 2": "dti", "Correlation": -0.05534838607810262}, {"Variable 1": "dti", "Variable 2": "dti", "Correlation": 1.0}, {"Variable 1": "fico", "Variable 2": "dti", "Correlation": -0.23737301296319976}, {"Variable 1": "days.with.cr.line", "Variable 2": "dti", "Correlation": 0.05445379584363774}, {"Variable 1": "revol.bal", "Variable 2": "dti", "Correlation": 0.1815985186976513}, {"Variable 1": "revol.util", "Variable 2": "dti", "Correlation": 0.3358042406321005}, {"Variable 1": "inq.last.6mths", "Variable 2": "dti", "Correlation": 0.019449525330139068}, {"Variable 1": "annual.inc", "Variable 2": "dti", "Correlation": -0.10992127894647656}, {"Variable 1": "int.rate", "Variable 2": "fico", "Correlation": -0.7130360105069175}, {"Variable 1": "installment", "Variable 2": "fico", "Correlation": 0.08008117426468929}, {"Variable 1": "log.annual.inc", "Variable 2": "fico", "Correlation": 0.10955820478606884}, {"Variable 1": "dti", "Variable 2": "fico", "Correlation": -0.23737301296319976}, {"Variable 1": "fico", "Variable 2": "fico", "Correlation": 1.0}, {"Variable 1": "days.with.cr.line", "Variable 2": "fico", "Correlation": 0.2538800828546055}, {"Variable 1": "revol.bal", "Variable 2": "fico", "Correlation": -0.01393510719778775}, {"Variable 1": "revol.util", "Variable 2": "fico", "Correlation": -0.5378888122896015}, {"Variable 1": "inq.last.6mths", "Variable 2": "fico", "Correlation": -0.18054293147553377}, {"Variable 1": "annual.inc", "Variable 2": "fico", "Correlation": 0.08843680320045276}, {"Variable 1": "int.rate", "Variable 2": "days.with.cr.line", "Correlation": -0.1217758897837466}, {"Variable 1": "installment", "Variable 2": "days.with.cr.line", "Correlation": 0.18189761041793417}, {"Variable 1": "log.annual.inc", "Variable 2": "days.with.cr.line", "Correlation": 0.33912910065344076}, {"Variable 1": "dti", "Variable 2": "days.with.cr.line", "Correlation": 0.05445379584363774}, {"Variable 1": "fico", "Variable 2": "days.with.cr.line", "Correlation": 0.2538800828546055}, {"Variable 1": "days.with.cr.line", "Variable 2": "days.with.cr.line", "Correlation": 1.0}, {"Variable 1": "revol.bal", "Variable 2": "days.with.cr.line", "Correlation": 0.23193716864555836}, {"Variable 1": "revol.util", "Variable 2": "days.with.cr.line", "Correlation": -0.021633587365778598}, {"Variable 1": "inq.last.6mths", "Variable 2": "days.with.cr.line", "Correlation": -0.04482161930242577}, {"Variable 1": "annual.inc", "Variable 2": "days.with.cr.line", "Correlation": 0.23198725526148542}, {"Variable 1": "int.rate", "Variable 2": "revol.bal", "Correlation": 0.09171674909731617}, {"Variable 1": "installment", "Variable 2": "revol.bal", "Correlation": 0.2298025606808621}, {"Variable 1": "log.annual.inc", "Variable 2": "revol.bal", "Correlation": 0.3747024846815357}, {"Variable 1": "dti", "Variable 2": "revol.bal", "Correlation": 0.1815985186976513}, {"Variable 1": "fico", "Variable 2": "revol.bal", "Correlation": -0.01393510719778775}, {"Variable 1": "days.with.cr.line", "Variable 2": "revol.bal", "Correlation": 0.23193716864555836}, {"Variable 1": "revol.bal", "Variable 2": "revol.bal", "Correlation": 1.0}, {"Variable 1": "revol.util", "Variable 2": "revol.bal", "Correlation": 0.19712659258953213}, {"Variable 1": "inq.last.6mths", "Variable 2": "revol.bal", "Correlation": 0.027803261441863274}, {"Variable 1": "annual.inc", "Variable 2": "revol.bal", "Correlation": 0.3709554528664497}, {"Variable 1": "int.rate", "Variable 2": "revol.util", "Correlation": 0.45877250859611823}, {"Variable 1": "installment", "Variable 2": "revol.util", "Correlation": 0.08295323053751776}, {"Variable 1": "log.annual.inc", "Variable 2": "revol.util", "Correlation": 0.05972736554294546}, {"Variable 1": "dti", "Variable 2": "revol.util", "Correlation": 0.3358042406321005}, {"Variable 1": "fico", "Variable 2": "revol.util", "Correlation": -0.5378888122896015}, {"Variable 1": "days.with.cr.line", "Variable 2": "revol.util", "Correlation": -0.021633587365778598}, {"Variable 1": "revol.bal", "Variable 2": "revol.util", "Correlation": 0.19712659258953213}, {"Variable 1": "revol.util", "Variable 2": "revol.util", "Correlation": 1.0}, {"Variable 1": "inq.last.6mths", "Variable 2": "revol.util", "Correlation": -0.016485401095750685}, {"Variable 1": "annual.inc", "Variable 2": "revol.util", "Correlation": 0.026847312655407712}, {"Variable 1": "int.rate", "Variable 2": "inq.last.6mths", "Correlation": 0.20303216402183577}, {"Variable 1": "installment", "Variable 2": "inq.last.6mths", "Correlation": -0.0040004293887224845}, {"Variable 1": "log.annual.inc", "Variable 2": "inq.last.6mths", "Correlation": 0.02251940151157754}, {"Variable 1": "dti", "Variable 2": "inq.last.6mths", "Correlation": 0.019449525330139068}, {"Variable 1": "fico", "Variable 2": "inq.last.6mths", "Correlation": -0.18054293147553377}, {"Variable 1": "days.with.cr.line", "Variable 2": "inq.last.6mths", "Correlation": -0.04482161930242577}, {"Variable 1": "revol.bal", "Variable 2": "inq.last.6mths", "Correlation": 0.027803261441863274}, {"Variable 1": "revol.util", "Variable 2": "inq.last.6mths", "Correlation": -0.016485401095750685}, {"Variable 1": "inq.last.6mths", "Variable 2": "inq.last.6mths", "Correlation": 1.0}, {"Variable 1": "annual.inc", "Variable 2": "inq.last.6mths", "Correlation": 0.027641137666096136}, {"Variable 1": "int.rate", "Variable 2": "annual.inc", "Correlation": 0.03980220552293717}, {"Variable 1": "installment", "Variable 2": "annual.inc", "Correlation": 0.3109994843055651}, {"Variable 1": "log.annual.inc", "Variable 2": "annual.inc", "Correlation": 0.7955875382758022}, {"Variable 1": "dti", "Variable 2": "annual.inc", "Correlation": -0.10992127894647656}, {"Variable 1": "fico", "Variable 2": "annual.inc", "Correlation": 0.08843680320045276}, {"Variable 1": "days.with.cr.line", "Variable 2": "annual.inc", "Correlation": 0.23198725526148542}, {"Variable 1": "revol.bal", "Variable 2": "annual.inc", "Correlation": 0.3709554528664497}, {"Variable 1": "revol.util", "Variable 2": "annual.inc", "Correlation": 0.026847312655407712}, {"Variable 1": "inq.last.6mths", "Variable 2": "annual.inc", "Correlation": 0.027641137666096136}, {"Variable 1": "annual.inc", "Variable 2": "annual.inc", "Correlation": 1.0}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>
<section id="data-transformation-and-preprocessing" class="level4">
<h4 class="anchored" data-anchor-id="data-transformation-and-preprocessing">4.5 Data Transformation and Preprocessing <br></h4>
<p>Since both <code>risk_category</code> and <code>loan_categories</code> are dereived from <code>fico</code>, we decided to drop the <code>fico</code> and <code>risk_category</code></p>
</section>
<section id="model-building" class="level4">
<h4 class="anchored" data-anchor-id="model-building">4.6 Model Building<br></h4>
<p>First we performed 10-folds cross-evaluation on four classifier models: DecisionTree, kNN-neighbours, SVC and Logistic Regression.</p>
<div id="1db7bcc9" class="cell" data-execution_count="23">
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fit_time</th>
<th data-quarto-table-cell-role="th">score_time</th>
<th data-quarto-table-cell-role="th">test_score</th>
<th data-quarto-table-cell-role="th">train_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Decision Tree</td>
<td>0.063(+/-0.002)</td>
<td>0.002(+/-0.000)</td>
<td>0.742(+/-0.014)</td>
<td>1.000(+/-0.000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">kNN</td>
<td>0.009(+/-0.000)</td>
<td>0.016(+/-0.006)</td>
<td>0.821(+/-0.007)</td>
<td>0.855(+/-0.002)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SVC</td>
<td>0.654(+/-0.010)</td>
<td>0.082(+/-0.001)</td>
<td>0.841(+/-0.002)</td>
<td>0.845(+/-0.000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Logistic Regression</td>
<td>0.013(+/-0.001)</td>
<td>0.002(+/-0.000)</td>
<td>0.839(+/-0.004)</td>
<td>0.840(+/-0.000)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>From the mean validation score and training score, we can see that the decision tree model has a much smaller cross-validation score compared to the other three models.</p>
<p>While the SVC model has a slightly larger test score than the logistic model, it requires a significantly longer computation time. Since the test score for SVC and Logistic Regression is very similar (both being ~0.84), We have opt for the logistic regression model as our predictor.</p>
<p>The train score of the Logistic Regression is the same as the validation score, suggesting that the model is likely not overfitted and will be able to generalize well to unseen data. While together with the fact that SVC has a significantly longer computation time,</p>
<div id="0e98fde5" class="cell" data-execution_count="25">
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rank_test_score</th>
<th data-quarto-table-cell-role="th">param_LogReg__C</th>
<th data-quarto-table-cell-role="th">mean_test_score</th>
<th data-quarto-table-cell-role="th">mean_train_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>0.000687</td>
<td>0.839989</td>
<td>0.839990</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>2</td>
<td>0.002812</td>
<td>0.839989</td>
<td>0.839743</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>0.000010</td>
<td>0.839859</td>
<td>0.839859</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>0.000016</td>
<td>0.839859</td>
<td>0.839859</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>0.000026</td>
<td>0.839859</td>
<td>0.839859</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6c3ae1fc" class="cell" data-execution_count="26">
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Model Accuracy: 0.8392</code></pre>
</div>
</div>
<div id="a008b64e" class="cell" data-execution_count="27">
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Predict Positive (defaulted)</th>
<th data-quarto-table-cell-role="th">Predict Negative (fully paid)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>True Positive (defaulted)</td>
<td>0</td>
<td>306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>True Negative (fully paid)</td>
<td>2</td>
<td>1608</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here, we identify the top 5 influential features for predicting each class. The Logistic Regression’s coefficients provide insights into feature importance, highlighting predictors such as:</p>
<p>fico: Higher credit score were strongly correlated with lower default risk.</p>
<p>loan_income_ratio: Borrowers with higher loan-to-income ratios exhibited a greater likelihood of default.</p>
<p>log.annual.inc: Borrowers with higher log annual income correlates with lower default risk.</p>
<p>int.rate: Borrowers with higher interest rates has a greater likelihood of default.</p>
<p>inq.last.6mths: Borrowers that has more inquires in the past 6 months has a higher default risk.</p>
<div id="a448b309" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">features</th>
<th data-quarto-table-cell-role="th">negative coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>num__fico</td>
<td>-0.104898</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>num__credit.policy</td>
<td>-0.102413</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>num__log.annual.inc</td>
<td>-0.038816</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="6258d28d" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">features</th>
<th data-quarto-table-cell-role="th">positive coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>num__int.rate</td>
<td>0.115715</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>num__inq.last.6mths</td>
<td>0.111241</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>num__loan_income_ratio</td>
<td>0.068905</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>On the test set, the model correctly predicted 1608 cases out of 1916, with 308 errors. These errors were distributed across false positives and false negatives. False negatives, representing cases where a defaulted loan was not flagged, pose a greater financial risk, as these borrowers are likely to incur losses. False positives, on the other hand, might result in stricter lending requirements for borrowers who would have successfully repaid their loans.</p>
<p>Despite the high accuracy score, our model fails to identify any of the 306 actual defaults loan. This suggest that the accuracy score is unable to fully reflect the model performance. Though our model is a great predictor in identifying negative loan defaults (over 99% of the fully paid cases identified), the high false negative makes its real life application limited. Further steps is needed to improve the model such that it can also predict defaulted loans well.</p>
</section>
<section id="limitations" class="level4">
<h4 class="anchored" data-anchor-id="limitations">4.8 Limitations</h4>
<div id="ee60f460" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>not.fully.paid
0    0.839859
1    0.160141
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<p>As we check the distribution of the target, we can see that the proportion of borrowers that has repayed their loans is significantly higher than those who defaulted their loans. The class imbalance of the target results in the model predicting most cases as “negative” (fully paid).</p>
<p>Possible solutions to the high false negtative include adjusting the <code>class_weight</code> hyperparameter or adjusting the decision threshold of the logistic model. Since accuracy might not fully reflect the model performance in the case of class imbalance, it would be good to include other evaluation metrics when evaulating model performance.</p>
<p>Also, based on the feature importances obtained, additional feature engineering or feature selection can potentially improve model performance.</p>
<p>To account for possible non-linear decision boundary, another alternative is to use a non-linear classification model, for example a decision tree, which can model complex non-linear decision boundaries better.</p>
</section>
</section>
</section>
<section id="reference" class="level1">
<h1>Reference</h1>
<ol type="1">
<li>Cai, S., Lin, X., Xu, D., &amp; Fu, X. (2016). Judging online peer-to-peer lending behavior: A comparison of first-time and repeated borrowing requests. Information &amp; Management, 53(7), 857-867.Consumer</li>
<li>Coşer, A., Maer-Matei, M. M., &amp; Albu, C. (2019). PREDICTIVE MODELS FOR LOAN DEFAULT RISK ASSESSMENT. Economic Computation &amp; Economic Cybernetics Studies &amp; Research, 53(2).</li>
<li>Equifax. (n.d.). <em>Credit score ranges.</em> Retrieved November 20, 2024, from <a href="https://www.equifax.com/personal/education/credit/score/articles/-/learn/credit-score-ranges/">https://www.equifax.com/personal/education/credit/score/articles/-/learn/credit-score-ranges/</a></li>
<li>Financial Protection Bureau. (n.d.). <em>Borrower risk profiles: Student loans</em>. Retrieved November 20, 2024, from <a href="https://www.consumerfinance.gov/data-research/consumer-credit-trends/student-loans/borrower-risk-profiles/">https://www.consumerfinance.gov/data-research/consumer-credit-trends/student-loans/borrower-risk-profiles/</a></li>
<li>Khandani, A. E., Kim, A. J., &amp; Lo, A. W. (2010). Consumer credit-risk models via machine-learning algorithms. Journal of Banking &amp; Finance, 34(11), 2767-2787.</li>
<li>Lenz, R. (2016). Peer-to-peer lending: Opportunities and risks. European Journal of Risk Regulation, 7(4), 688-700</li>
<li>myFICO. (n.d.). <em>What’s in my FICO® Scores?</em> Retrieved November 20, 2024, from [https://www.myfico.com/credit-education/whats-in-your-credit-score](https://www.myfico.com/credit-education/whats-in-your-credit-score#:~:text=FICO%20Scores%20are%20calculated%20using,and%20credit%20mix%20(10%25)</li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>